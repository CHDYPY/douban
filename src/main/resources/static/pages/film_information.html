<!DOCTYPE html>
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title>CHD_观影指南</title>
    <!--<meta name="description" content="">-->
    <!--<meta name="author" content="">-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../plugins/webapps/css/base.css">
    <link rel="stylesheet" href="../plugins/webapps/css/vendor.css">
    <link rel="stylesheet" href="../plugins/webapps/css/main.css">
    <script src="../plugins/webapps/js/modernizr.js"></script>
    <link rel="apple-touch-icon" sizes="180x180" href="../plugins/webapps/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../plugins/webapps/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../plugins/webapps/images/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
</head>

<body class="ss-bg-white">

<div id="preloader">
    <div id="loader" class="dots-fade">
        <div></div>
        <div></div>
        <div></div>
    </div>
</div>

<div id="top" class="s-wrap site-wrapper">

    <header class="s-header header">

        <div class="header__top">
            <div class="header__logo">
                <a class="site-logo smoothscroll" href="#top">
                    <img src="../plugins/webapps/images/logo.svg" alt="Homepage">
                </a>
            </div>

            <!-- toggles -->
            <a href="#0" class="header__search-trigger"></a>
            <a href="#0" class="header__menu-toggle"><span>Menu</span></a>

        </div>

        <nav class="header__nav-wrap">

            <ul class="header__nav">
                <li><a href="film_index.html" title="">首页</a></li>
                <li><a href="film_top20.html" title="">Top 20</a></li>
                <li><a href="film_year.html" title="">年度推荐</a></li>
                <li><a href="film_classfiy.html" title="">选好片</a></li>
                <!--<li class="has-children">-->
                <!--<a href="#0" title="">选好片</a>-->
                <!--<ul class="sub-menu">-->
                <!--<li><a href="category.html">大陆</a></li>-->
                <!--<li><a href="category.html">港澳台</a></li>-->
                <!--<li><a href="category.html">欧美</a></li>-->
                <!--<li><a href="category.html">小语种</a></li>-->
                <!--</ul>-->
                <!--</li>-->
                <!--<li><a href="page-about.html" title="">About</a></li>-->
                <!--<li><a href="page-contact.html" title="">Contact</a></li>-->
            </ul> <!-- end header__nav -->

            <ul class="header__social">
                <li class="ss-facebook">
                    <a href="https://facebook.com/">
                        <span class="screen-reader-text">Facebook</span>
                    </a>
                </li>
                <li class="ss-twitter">
                    <a href="#0">
                        <span class="screen-reader-text">Twitter</span>
                    </a>
                </li>
                <li class="ss-dribbble">
                    <a href="#0">
                        <span class="screen-reader-text">Dribbble</span>
                    </a>
                </li>
                <li class="ss-pinterest">
                    <a href="#0">
                        <span class="screen-reader-text">Behance</span>
                    </a>
                </li>
            </ul>

        </nav> <!-- end header__nav-wrap -->

    </header> <!-- end s-header -->


    <!-- 主体内容部分 -->
    <div class="s-content content" style="background: #FAFAD2">
        <main class="row content__page">
            <article class="column large-full entry format-standard">

                <div class="media-wrap entry__media" id="img">
                    <div class="entry__post-thumb">
                        <a href="../plugins/webapps/images/thumbs/single/standard/piano.webp" class="entry__thumb-link">
                            <img src="../plugins/webapps/images/thumbs/single/standard/piano.webp" alt=""
                                 style="margin-left: 260px">
                        </a>
                    </div>
                </div>

                <div class="content__page-header entry__header" id="brief_info">
                    <h1 class="display-1 entry__title">海上钢琴师</h1>
                    <h1 class="display-1 entry__title"></h1>
                    <ul class="entry__header-meta">
                        <li>导演： <a href="#0">蒂姆·罗斯</a></li>
                        <li>类型： <!--<a href="#0">剧情，</a><a href="#0">音乐</a>--></li>
                    </ul>
                </div>

                <div class="entry__content" id="detail_info">

                    <h2>剧情简介</h2>

                    <p>
                        本片讲述了一个钢琴天才传奇的一生。
                        1900年，Virginian号豪华邮轮上，一个孤儿被遗弃在头等舱，由船上的水手抚养长大，取名1900（蒂姆•罗斯
                        饰）。1900慢慢长大，显示出了无师自通的非凡钢琴天赋，在船上的乐队表演钢琴，每个听过他演奏的人，都被深深打动。爵士
                        乐鼻祖杰尼听说了1900的高超技艺，专门上船和他比赛，最后自叹弗如，黯然离去。
                        可惜，这一切的事情都发生在海上，1900从来不愿踏上陆地，直到有一天，他爱上了一个女孩，情愫在琴键上流淌。他会不会为了爱情，踏上陆地开始新的生活，用他的琴声惊艳世界？他将怎样谱写自己非凡的人生。
                    </p>

                    <blockquote>
                        <cite>详细信息</cite>
                        <p>
                        <li>演员： <!--<a href="#0">蒂姆·罗斯</a>--></li>
                        <br>
                        <li>导演： <!--<a href="#0">蒂姆·罗斯</a>--></li>
                        <br>
                        <li>编剧： <!--<a href="#0">亚利桑德罗·巴里克</a>,<a href="#0">朱塞佩·托纳多雷</a>--> </li>
                        <br>
                        <li>语言： <!--英语 / 法语 / 意大利语--></li>
                        <br>
                        <li>上映日期： <!--2019-11-15(中国大陆) / 1998-10-28(意大利)--></li>
                        <br>
                        <li>片长： <!--165分钟 / 120分钟(法国版) / 169分钟(加长版) / 125分钟(中国大陆)--></li>
                        <br>
                        <li>又名：
                            <!--声光伴我飞(港) / 一九零零的传奇 / 1900海上钢琴师 / 传奇1900 / The Legend of 1900 / The Legend Of The Pianist On The Ocean--></li>
                        </p>
                    </blockquote>

                    <p class="entry__tags">
                        <span>用户评价</span>

                        <span class="entry__tag-list" style="width: 80%">
                            <a href="#0" style="margin-left: 30px;">一星</a>
                            <a href="#0" style="margin-left: 30px;">二星</a>
                            <a href="#0" style="margin-left: 30px;">三星</a>
                            <a href="#0" style="margin-left: 30px;">四星</a>
                            <a href="#0" style="margin-left: 30px;">五星</a>
                        </span>

                    </p>
                    <canvas id="a_canvas" width="600" height="100" style="margin-left: 120px"></canvas>
                </div> <!-- end entry content -->

                <!--<div class="entry__related" id="relative_film">-->
                    <!--<h3 class="h2">相关电影</h3>-->

                    <!--<ul class="related">-->
                        <!--<li class="related__item">-->
                            <!--<a href="single-standard.html" class="related__link">-->
                                <!--<img src="../plugins/webapps/images/thumbs/masonry/walk-600.jpg" alt="">-->
                            <!--</a>-->
                            <!--<h5 class="related__post-title">Using Repetition and Patterns in Photography.</h5>-->
                        <!--</li>-->
                        <!--<li class="related__item">-->
                            <!--<a href="single-standard.html" class="related__link">-->
                                <!--<img src="../plugins/webapps/images/thumbs/masonry/dew-600.jpg" alt="">-->
                            <!--</a>-->
                            <!--<h5 class="related__post-title">Health Benefits Of Morning Dew.</h5>-->
                        <!--</li>-->
                        <!--<li class="related__item">-->
                            <!--<a href="single-standard.html" class="related__link">-->
                                <!--<img src="../plugins/webapps/images/thumbs/masonry/rucksack-600.jpg" alt="">-->
                            <!--</a>-->
                            <!--<h5 class="related__post-title">The Art Of Visual Storytelling.</h5>-->
                        <!--</li>-->
                    <!--</ul>-->
                <!--</div>-->

            </article>

        </main>

    </div> <!-- end s-content -->

    <div class="go-top" style="margin-right: 50px">
        <a class="smoothscroll" title="Back to Top" href="#top"></a>
    </div>

</div> <!-- end s-wrap -->


<!-- Java Script
================================================== -->
<script src="../plugins/webapps/js/jquery-3.2.1.min.js"></script>
<script src="../plugins/webapps/js/plugins.js"></script>
<script src="../plugins/webapps/js/main.js"></script>

<script>
    $(document).ready(function () {
        var id = getQueryVariable("film_id");
        if (id == null || id == "") {
            alert("无电影信息！");
            location.href = "film_index.html";
        }


        $.ajax({
            "url": "/film/findvfilmbycon?filmId=" + id,
            "type": "get",
            "dataType": "json",
            "data": {"fid": id},
            "success": function (obj) {
                if (obj.state === 1) {
                    var film_id = obj.data[0]["filmId"];
                    var film_name = obj.data[0]["title"]; //电影名
                    var index = film_name.indexOf(" ");
                    var film_name1 = film_name.substring(0,index);
                    var film_name2 = film_name.substring(index+1,film_name.length);

                    var film_img = obj.data[0]["src"];	//图片url
                    var film_actor = obj.data[0]["actor"].split(',');	//演员
                    var film_director = obj.data[0]["director"].split(',');	//导演
                    var film_script = obj.data[0]["writer"].split(',');	//编剧
                    var type = obj.data[0]["types"].replace(/[\[\]' ]/g, '').split(',');	//类型
                    var content = obj.data[0]["description"];	//简介
                    console.log(content);
                    var language = obj.data[0]["language"];	//语言
                    var time = obj.data[0]["releaseDate"].split('/');	//时间
                    var year = obj.data[0]["year"];	//上映年份
                    var duration = obj.data[0]["size"];	//时长
                    var other_name = obj.data[0]["otherName"];	//又名
                    // var star_1 = obj.data[0]["star_1"];	//一星
                    // var star_2 = obj.data[0]["star_2"];	//二星
                    // var star_3 = obj.data[0]["star_3"];	//三星
                    // var star_4 = obj.data[0]["star_4"];	//四星
                    // var star_5 = obj.data[0]["star_5"];	//五星
                    var star = obj.data[0]['starPercent'].replace(/[\[\] '%]/g, '').split(',');
                    var star_all = obj.data[0]["star_all"];	//总星级

                    $("#img a:eq(0)").attr("href", film_img);
                    $("#img img:eq(0)").attr("src", film_img);
                    $("#brief_info h1:eq(0)").text(film_name1);
                    $("#brief_info h1:eq(1)").text(film_name2);
                    $("#brief_info a:eq(0)").text(film_director[0].split(" ")[0]);

                    var li = $("#brief_info li:eq(1)");
                    for (let i = 0, len = type.length; i < len; i++) {
                        li.append('<a href="#0">' + type[i] + '</a>');
                        if(i < len-1) li.append('，');
                    }

                    var detail = $("#detail_info");
                    detail.find("p:eq(0)").text(content);
                    var li_1 = detail.find("li:eq(0)");
                    for (let i = 0, len = film_actor.length; i < len; i++) {
                        li_1.append('<a href="celebrity_info.html?fid='+ film_id + '&cName='+ film_actor[i].split(" ")[0] +'">' + film_actor[i].split(" ")[0] + '</a>');
                        if(i < len-1) li_1.append('，');
                    }

                    var li_2 = detail.find("li:eq(1)");
                    for (let i = 0, len = film_director.length; i < len; i++) {
                        li_2.append('<a href="celebrity_info.html?fid='+ film_id + '&cName=' + film_director[i].split("  ")[0] +'">' + film_director[i].split(" ")[0] + '</a>');
                        if(i < len-1) li_2.append('，');
                    }

                    var li_3 = detail.find("li:eq(2)");
                    for (let i = 0, len = film_script.length; i < len; i++) {
                        li_3.append('<a href="celebrity_info.html?fid='+ film_id + '&cName=' + film_script[i].split(" ")[0] +'">' + film_script[i].split(" ")[0] + '</a>');
                        if(i < len-1) li_3.append('，');
                    }

                    // var li_4 = detail.find("li:eq(3)");
                    // for(let i=0,len=language.length;i<len;i++){
                    //     li_4.append(" / "+language[i])
                    // }
                    detail.find("li:eq(3)").append(language);

                    var li_5 = detail.find("li:eq(4)");
                    for (let i = 0, len = time.length; i < len; i++) {
                        li_5.append(time[i]);
                        if(i < len-1) li_5.append('/');
                    }
                    detail.find("li:eq(5)").append(duration + 'min');
                    // var li_7 = detail.find("li:eq(6)");
                    // for(let i=0,len=other_name.length;i<len;i++){
                    //     li_7.append(" / "+other_name[i])
                    // }
                    detail.find("li:eq(6)").append(other_name);

                    for(let i=0,len=star.length;i<len;i++){
                        star[i] = Number(star[i])/100;
                    }
                    draw(star.reverse());
                } else {
                    alert(obj.message);
                }
            },
            "error": function () {
                alert('请求错误！');
            }
        });


    });

    function draw(data) {

        // 获取上下文
        var a_canvas = document.getElementById('a_canvas');
        var context = a_canvas.getContext("2d");

        // 绘制背景
        var gradient = context.createLinearGradient(0, 0, 0, 300);


        // gradient.addColorStop(0,"#e0e0e0");
        //gradient.addColorStop(1,"#ffffff");

        context.fillStyle = gradient;

        context.fillRect(0, 0, a_canvas.width, a_canvas.height);

        var realheight = a_canvas.height - 15;
        var realwidth = a_canvas.width - 40;
        // 描绘边框
        var grid_cols = data.length + 1;
        var grid_rows = 4;
        var cell_height = realheight / grid_rows;
        var cell_width = realwidth / grid_cols;
        context.lineWidth = 1;
        context.strokeStyle = "#a0a0a0";

        // 结束边框描绘
        context.beginPath();

        //划横线
        context.moveTo(0, realheight);
        context.lineTo(realwidth, realheight);


        //画竖线
        // context.moveTo(0,20);
        // context.lineTo(0,realheight);
        context.lineWidth = 1;
        context.strokeStyle = "black";
        context.stroke();


        var max_v = 0;

        for (var i = 0; i < data.length; i++) {
            if (data[i] > max_v) {
                max_v = data[i]
            }
            ;
        }
        max_v = max_v * 1.1;
        // 将数据换算为坐标
        var points = [];
        for (var i = 0; i < data.length; i++) {
            var v = data[i];
            var px = cell_width * (i + 1);
            var py = realheight - realheight * (v / max_v);
            //alert(py);
            points.push({"x": px, "y": py});
        }

        //绘制坐标图形
        for (var i in points) {
            var p = points[i];
            context.beginPath();
            context.fillStyle = "#F4A460";
            context.fillRect(p.x, p.y, 15, realheight - p.y);

            context.fill();
        }
        //添加文字
        for (var i in points) {
            var p = points[i];
            context.beginPath();
            context.fillStyle = "#F4A460";
            context.fillText((data[i] * 100.00).toFixed(2) + '%', p.x - 8, realheight + 15);
        }
    }

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }


</script>

</body>